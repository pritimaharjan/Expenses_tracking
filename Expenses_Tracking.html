<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracking System</title>
    <style>
        .main{
            display: flex;
            justify-content: center;
        }
        .container{
            display: flex;
            flex-direction: column;
            justify-content: center;
           padding: 10px 10px;
           margin: 10px 10px;
            background-color: #008b8b;
            height: auto;
            width: fit-content;
            color: black;
            box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
            border-radius: 10px;
        }
        #description ,#amount
        {
            height: 30px;
            padding: 3px;
            border: 1px;
            border-radius: 5px;
        }
        button{
            height: 35px;
            padding: 3px;
            border: 1px;
            border-radius: 5px;
           
            background-color: none;
        }
.total{
    display: flex;
justify-content: flex-end;
color: antiquewhite;

}
#des{
     display: flex;
    flex-direction: row;
    color: aliceblue;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
    
}

.expenses_list{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    margin: 10px;
     
}
#edit, #delete{
    width: 80px;
}
#search{
    height: 30px;
            padding: 3px;
            border: 1px;
            border-radius: 5px;
}
    </style>
</head>
<body>
    <div class="main">
        <div class="container">
<form  id="form" class="form">
        <input type="Text" placeholder="Description" id="description">
        <input type="number" placeholder="Amount" id="amount">
        <button type="submit">Add Expenses</button>
        
        <input type="text" id="search" placeholder="Search expenses...">
        <ul id="expenses_list"></ul>
    </form>
    
     <div class="total">
        Total : Rs<span id="total">00.0</span>
        </div>
        <div>
            <button onclick="downloadList()">Download list</button>
        </div>
    
    </div>
    </div>
    

    <script>
        const form = document.getElementById("form")
        const descriptionInput = document.getElementById("description")
        const amountInput = document.getElementById("amount")
        const expenseList = document.getElementById("expenses_list")
        const totalDisplay = document.getElementById("total")

        let storage = JSON.parse(localStorage.getItem("storage")) ||[]

       function saveExpense(){
        localStorage.setItem("storage",JSON.stringify(storage))
       } 
     function renderExpense(filteredData) {
  // If no filteredData is provided, use the full storage array
  const dataToRender = filteredData || storage;

  expenseList.innerHTML = "";
  let total = 0;

  dataToRender.forEach((expense, i) => {
    const li = document.createElement("li");
    li.innerHTML = `
      <div class="expenses_list">
        <div id="des">
          <span>${expense.description}</span>
          <span>${expense.amount}</span>
          <span>${expense.date}</span>
        </div>
        <div id="button">
          <button onclick="editExpense(${storage.indexOf(expense)})" id="edit">Edit</button>
          <button onclick="deleteExpense(${storage.indexOf(expense)})" id="delete">Delete</button>
        </div>
      </div>
    `;
    expenseList.appendChild(li);
    total += expense.amount;
  });

  totalDisplay.textContent = total.toFixed(2);
}

       function downloadList(){
        let csv="Categories,Amount,Date\n" 

        storage.forEach(expense=>{csv+=`${expense.description},${expense.amount},${expense.date}\n`;});

        const blob =new Blob([csv],{type:"text/csv"});
        const url=URL.createObjectURL(blob);

        const a=document.createElement("a");
        a.href = url;
        a.download = "expense.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);

       }
      

        form.addEventListener("submit",function(e){
            e.preventDefault();
              const description=descriptionInput.value.trim()
              const amount =parseFloat(amountInput.value)
              
              if(!description || isNaN(amount) || amount<=0)
              {
                alert("please, enter valied imformation");
                return;
              }

             const expense ={
               description,
               amount,
               date:new Date().toLocaleDateString()
              }
              storage.push(expense)
                saveExpense();
                renderExpense();
                form.reset();
              

        });
        window.deleteExpense= function(i){
            storage.splice(i,1)
            saveExpense();
            renderExpense();

        }
        window.editExpense = function(i){
            const newdescription =prompt("edit description",storage[i].description)
            const newamount =parseFloat(prompt("edit amount",storage[i].amount))
            if (!newdescription || isNaN(newamount) || newamount<=0 )
            {
                alert("please, enter valid  input")
                return;
            }
            storage[i].description =newdescription
            storage[i].amount = newamount
            saveExpense();
            renderExpense();

        }
        const searchInput = document.getElementById("search");




// Search filter
searchInput.addEventListener("input", function() {
  const searchText = searchInput.value.toLowerCase();
  const filtered = storage.filter(expense => 
    expense.description.toLowerCase().includes(searchText)
  );
  renderExpense(filtered);
});

        renderExpense();
    </script>
</body>
</html>
